<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Validación CPDD</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:linear-gradient(135deg,#001a4d,#003d99);font-family:Arial,sans-serif;padding:20px;min-height:100vh}
.app{max-width:900px;margin:0 auto;background:#fff;border-radius:12px;padding:50px;box-shadow:0 0 30px rgba(0,0,0,0.3)}
.encabezado{text-align:center;margin-bottom:40px;padding-bottom:20px;border-bottom:3px solid #001a4d}
.encabezado h1{font-size:28px;color:#001a4d;margin-bottom:10px}
.encabezado p{color:#0052cc;font-size:13px}
.progreso{background:#e0e0e0;height:8px;border-radius:5px;margin:20px 0;overflow:hidden}
.progreso-barra{background:#001a4d;height:100%;width:5%;transition:width 0.4s}
.contador{text-align:center;font-size:12px;color:#666;margin-bottom:15px}
.contenedor-paginas{min-height:400px;position:relative}
.pagina{display:none}
.pagina.visible{display:block;animation:entrada 0.3s}
@keyframes entrada{from{opacity:0}to{opacity:1}}
.titulo-pagina{font-size:16px;font-weight:bold;color:#001a4d;border-bottom:2px solid #001a4d;padding-bottom:10px;margin-bottom:20px}
.campo{margin:20px 0}
.campo label{display:block;font-weight:bold;font-size:13px;margin-bottom:8px;color:#333}
.campo input{width:100%;padding:10px;border:2px solid #ddd;border-radius:6px;font-size:14px;font-family:Arial}
.campo input:focus{outline:none;border-color:#001a4d;box-shadow:0 0 8px rgba(0,26,77,0.2)}
.grupo-checkbox{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
.item-checkbox{display:flex;gap:8px;align-items:center}
.item-checkbox input{width:16px;height:16px;cursor:pointer}
.item-checkbox label{margin:0;font-size:12px;cursor:pointer;font-weight:normal}
.aviso-consentimiento{background:#e8f4ff;border-left:4px solid #001a4d;padding:15px;border-radius:6px;font-size:12px;line-height:1.8;margin-bottom:20px}
.aviso-consentimiento p{margin:8px 0}
.aviso-consentimiento ul{margin-left:25px;margin-top:10px}
.aviso-consentimiento li{margin:5px 0}
.checkbox-unico{display:flex;gap:10px;align-items:flex-start;margin:20px 0}
.checkbox-unico input{width:18px;height:18px;cursor:pointer;margin-top:2px}
.checkbox-unico label{font-size:12px;cursor:pointer;margin:0;font-weight:normal}
.recordatorio{background:#e3f2ff;border-left:3px solid #1976d2;padding:12px;border-radius:5px;font-size:11px;color:#0d47a1;margin-bottom:20px}
.bloque-imagen{background:#f5f5f5;border-left:4px solid #0066cc;padding:18px;border-radius:6px;margin-bottom:20px}
.titulo-imagen{font-weight:bold;font-size:15px;color:#001a4d;margin-bottom:12px}
.area-imagen{width:100%;height:200px;border:2px dashed #0066cc;border-radius:6px;display:flex;align-items:center;justify-content:center;background:#e8f4ff;color:#0066cc;font-size:13px;margin-bottom:15px}
.item-criterio{margin-bottom:15px}
.etiqueta-criterio{font-size:11px;font-weight:bold;color:#333;margin-bottom:8px}
.botones-calificacion{display:flex;gap:6px}
.botones-calificacion button{flex:1;padding:8px;border:2px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;font-weight:bold;font-size:12px;transition:all 0.2s}
.botones-calificacion button:hover{border-color:#0066cc;background:#e8f4ff}
.botones-calificacion button.marcado{background:#001a4d;color:#fff;border-color:#001a4d}
.caja-resumen{background:#e8f4ff;border-left:4px solid #001a4d;padding:15px;border-radius:6px;margin-bottom:20px}
.linea-resumen{font-size:12px;margin:8px 0}
.linea-resumen strong{color:#001a4d}
.tabla-resultados{width:100%;border-collapse:collapse;margin:20px 0;background:#fff;font-size:12px;box-shadow:0 1px 5px rgba(0,0,0,0.1)}
.tabla-resultados th{background:#001a4d;color:#fff;padding:10px;text-align:left;font-weight:bold}
.tabla-resultados td{padding:10px;border-bottom:1px solid #eee}
.tabla-resultados tr:nth-child(even){background:#f9f9f9}
.seccion-resultado{text-align:center}
.titulo-resultado{font-size:24px;color:#001a4d;margin-bottom:25px;font-weight:bold}
.mensaje-exito{background:#e8f5e9;color:#2e7d32;padding:15px;border-radius:6px;border-left:4px solid #2e7d32;margin-top:20px;font-size:13px;display:none}
.grupo-botones{display:flex;gap:12px;margin-top:40px;justify-content:space-between}
.boton{padding:12px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:14px;transition:all 0.2s}
.boton-atras{background:#ddd;color:#333}
.boton-atras:hover:not(:disabled){background:#ccc}
.boton-atras:disabled{opacity:0.5;cursor:not-allowed}
.boton-siguiente{background:#001a4d;color:#fff;flex:1;margin-left:10px}
.boton-siguiente:hover:not(:disabled){background:#003d99}
.boton-siguiente:disabled{opacity:0.4;cursor:not-allowed}
</style>
</head>
<body>

<div class="app">

<div class="encabezado">
<h1>VALIDACIÓN DE EXPERTOS</h1>
<p>Cuestionario de Precisión Diagnóstica Dermatológica - CPDD-IC</p>
</div>

<div class="contador">
<span id="contador-paginas">Página 1 de 19</span>
</div>

<div class="progreso">
<div class="progreso-barra" id="barra-progreso"></div>
</div>

<div class="contenedor-paginas">

<!-- PÁGINA 0: DATOS -->
<div class="pagina visible" id="pagina-0">
<div class="titulo-pagina">1. DATOS DEL ESPECIALISTA</div>
<div class="campo">
<label>Nombre completo *</label>
<input type="text" id="nombre" oninput="verificar_boton()">
</div>
<div class="campo">
<label>Cédula Médica (CMP) *</label>
<input type="text" id="cmp" oninput="verificar_boton()">
</div>
<div class="campo">
<label>Registro Nacional Especialista (RNE) *</label>
<input type="text" id="rne" oninput="verificar_boton()">
</div>
<div class="campo">
<label>Email *</label>
<input type="email" id="email" oninput="verificar_boton()">
</div>
<div class="campo">
<label>Institución(es) donde trabaja (Marque al menos una)</label>
<div class="grupo-checkbox">
<div class="item-checkbox"><input type="checkbox" id="inst-1" value="MINSA" onchange="verificar_boton()"><label for="inst-1">MINSA</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-2" value="EsSalud" onchange="verificar_boton()"><label for="inst-2">EsSalud</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-3" value="Hospital Privado" onchange="verificar_boton()"><label for="inst-3">Hospital Privado</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-4" value="Clínica Privada" onchange="verificar_boton()"><label for="inst-4">Clínica Privada</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-5" value="Consultorio" onchange="verificar_boton()"><label for="inst-5">Consultorio Privado</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-6" value="Universidad" onchange="verificar_boton()"><label for="inst-6">Universidad</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-7" value="Instituto" onchange="verificar_boton()"><label for="inst-7">Instituto</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-8" value="Otro" onchange="verificar_boton()"><label for="inst-8">Otro</label></div>
</div>
</div>
<div class="campo">
<label>Años de experiencia en dermatología *</label>
<input type="number" id="experiencia" min="1" max="80" oninput="verificar_boton()">
</div>
</div>

<!-- PÁGINA 1: CONSENTIMIENTO -->
<div class="pagina" id="pagina-1">
<div class="titulo-pagina">2. CONSENTIMIENTO INFORMADO</div>
<div class="aviso-consentimiento">
<p><strong>Estimado especialista:</strong></p>
<p>Se solicita su participación como experto en la validación de un instrumento de evaluación diagnóstica dermatológica.</p>
<p><strong>Sus derechos:</strong></p>
<ul>
<li>Su participación es completamente voluntaria</li>
<li>Puede retirarse en cualquier momento</li>
<li>Sus datos serán tratados de forma confidencial</li>
<li>Los datos se utilizarán únicamente con fines académicos</li>
</ul>
</div>
<div class="checkbox-unico">
<input type="checkbox" id="consentimiento" onchange="verificar_boton()">
<label for="consentimiento">Acepto participar voluntariamente y autorizo el uso de mis datos</label>
</div>
</div>

<!-- PÁGINA 2: INSTRUCCIONES -->
<div class="pagina" id="pagina-2">
<div class="titulo-pagina">3. INSTRUCCIONES PARA LA EVALUACIÓN</div>
<h3 style="color:#001a4d;margin-bottom:12px;font-size:14px">Escala de Calificación (1-5):</h3>
<div style="margin-bottom:15px">
<h4 style="color:#0066cc;font-size:13px;margin-bottom:8px">Representatividad Diagnóstica:</h4>
<ul style="margin-left:25px;font-size:12px;line-height:1.7">
<li><strong>1-2:</strong> No representativa</li>
<li><strong>3:</strong> Moderadamente representativa</li>
<li><strong>4-5:</strong> Representativa o altamente representativa</li>
</ul>
</div>
<div style="margin-bottom:15px">
<h4 style="color:#0066cc;font-size:13px;margin-bottom:8px">Calidad Técnica Fotográfica:</h4>
<ul style="margin-left:25px;font-size:12px;line-height:1.7">
<li><strong>1-2:</strong> Pobre/regular</li>
<li><strong>3:</strong> Aceptable</li>
<li><strong>4-5:</strong> Buena/excelente</li>
</ul>
</div>
<div style="margin-bottom:15px">
<h4 style="color:#0066cc;font-size:13px;margin-bottom:8px">Ausencia de Sesgo Visual:</h4>
<ul style="margin-left:25px;font-size:12px;line-height:1.7">
<li><strong>1-2:</strong> Presencia evidente de pistas</li>
<li><strong>3:</strong> Pocas pistas sesgadas</li>
<li><strong>4-5:</strong> Sin pistas no intencionadas</li>
</ul>
</div>
</div>

<!-- PÁGINAS 3-17: 15 IMÁGENES -->
<div id="contenedor-imagenes"></div>

<!-- PÁGINA 18: RESULTADOS -->
<div class="pagina" id="pagina-18">
<div class="seccion-resultado">
<div class="titulo-resultado">✓ Validación Completada</div>
<div class="caja-resumen">
<div class="linea-resumen"><strong>Evaluador:</strong> <span id="res-nombre"></span></div>
<div class="linea-resumen"><strong>CMP:</strong> <span id="res-cmp"></span></div>
<div class="linea-resumen"><strong>Institución(es):</strong> <span id="res-institucion"></span></div>
<div class="linea-resumen"><strong>Fecha:</strong> <span id="res-fecha"></span></div>
</div>
<h3 style="color:#001a4d;margin:20px 0 12px 0;font-size:14px">Resumen de Evaluaciones</h3>
<table class="tabla-resultados">
<thead><tr><th>#</th><th>Patología</th><th>Rep</th><th>Cal</th><th>Ses</th></tr></thead>
<tbody id="cuerpo-tabla"></tbody>
</table>
<div class="mensaje-exito" id="exito">✓ Los datos se han guardado automáticamente en Google Drive y Sheets</div>
</div>
</div>

</div>

<!-- BOTONES NAVEGACIÓN -->
<div class="grupo-botones">
<button class="boton boton-atras" onclick="ir_pagina_anterior()" id="btn-atras" style="display:none">← Anterior</button>
<button class="boton boton-siguiente" onclick="ir_pagina_siguiente()" id="btn-siguiente" disabled>Siguiente →</button>
</div>

</div>

<script>
const PATOLOGIAS=[
{id:1,nombre:"Acné vulgar"},
{id:2,nombre:"Dermatitis atópica"},
{id:3,nombre:"Queratosis seborreica"},
{id:4,nombre:"Impétigo no bulloso"},
{id:5,nombre:"Psoriasis"},
{id:6,nombre:"Melanoma"},
{id:7,nombre:"Verruga vulgar"},
{id:8,nombre:"Rosácea"},
{id:9,nombre:"Tiña corporis"},
{id:10,nombre:"Carcinoma basocelular"},
{id:11,nombre:"Nevo melanocítico común"},
{id:12,nombre:"Lentigo solar"},
{id:13,nombre:"Queratosis actínica"},
{id:14,nombre:"Dermatitis de contacto alérgica"},
{id:15,nombre:"Molusco contagioso"}
];

const URL_SHEETS="https://script.google.com/macros/s/AKfycbyBujwpBus6VR8STMZe13wgvgugB-uwx1zN4aWCSHdume_oa5Ey56K7lJbhwQf7WXnl/exec";

let pagina=0;
let evals={};
let usuario={};

function crear_imagenes(){
const cont=document.getElementById("contenedor-imagenes");
PATOLOGIAS.forEach((p,i)=>{
const div=document.createElement("div");
div.className="pagina";
div.id="pagina-"+(i+3);
div.innerHTML=`
<div class="recordatorio">Califique cada criterio de 1 (inaceptable) a 5 (excelente)</div>
<div class="bloque-imagen">
<div class="titulo-imagen">Imagen ${p.id}: ${p.nombre}</div>
<div class="area-imagen">[Imagen ${p.id}]</div>
<div class="item-criterio">
<div class="etiqueta-criterio">Representatividad diagnóstica</div>
<div class="botones-calificacion">
<button type="button" onclick="calif(${p.id},'rep',1)">1</button>
<button type="button" onclick="calif(${p.id},'rep',2)">2</button>
<button type="button" onclick="calif(${p.id},'rep',3)">3</button>
<button type="button" onclick="calif(${p.id},'rep',4)">4</button>
<button type="button" onclick="calif(${p.id},'rep',5)">5</button>
</div>
</div>
<div class="item-criterio">
<div class="etiqueta-criterio">Calidad técnica fotográfica</div>
<div class="botones-calificacion">
<button type="button" onclick="calif(${p.id},'cal',1)">1</button>
<button type="button" onclick="calif(${p.id},'cal',2)">2</button>
<button type="button" onclick="calif(${p.id},'cal',3)">3</button>
<button type="button" onclick="calif(${p.id},'cal',4)">4</button>
<button type="button" onclick="calif(${p.id},'cal',5)">5</button>
</div>
</div>
<div class="item-criterio">
<div class="etiqueta-criterio">Ausencia de sesgo visual</div>
<div class="botones-calificacion">
<button type="button" onclick="calif(${p.id},'ses',1)">1</button>
<button type="button" onclick="calif(${p.id},'ses',2)">2</button>
<button type="button" onclick="calif(${p.id},'ses',3)">3</button>
<button type="button" onclick="calif(${p.id},'ses',4)">4</button>
<button type="button" onclick="calif(${p.id},'ses',5)">5</button>
</div>
</div>
</div>
`;
cont.appendChild(div);
});
}

function calif(id,tipo,val){
if(!evals[id])evals[id]={};
evals[id][tipo]=val;
event.target.parentNode.querySelectorAll("button").forEach(b=>b.classList.remove("marcado"));
event.target.classList.add("marcado");
verificar_boton();
}

function cambiar(){
document.querySelectorAll(".pagina").forEach(p=>p.classList.remove("visible"));
document.getElementById("pagina-"+pagina).classList.add("visible");
document.getElementById("contador-paginas").textContent="Página "+(pagina+1)+" de 19";
document.getElementById("barra-progreso").style.width=((pagina+1)/19*100)+"%";
document.getElementById("btn-atras").style.display=pagina===0?"none":"block";
let btn=document.getElementById("btn-siguiente");
btn.textContent=pagina===17?"Enviar Validación ✓":"Siguiente →";
verificar_boton();
}

function verificar_boton(){
let btn=document.getElementById("btn-siguiente");
if(pagina===0){
let n=document.getElementById("nombre").value.trim();
let c=document.getElementById("cmp").value.trim();
let e=document.getElementById("email").value.trim();
let ex=document.getElementById("experiencia").value.trim();
let inst=Array.from(document.querySelectorAll("#inst-1,#inst-2,#inst-3,#inst-4,#inst-5,#inst-6,#inst-7,#inst-8")).some(i=>i.checked);
btn.disabled=!(n&&c&&e&&ex&&inst);
}else if(pagina===1){
btn.disabled=!document.getElementById("consentimiento").checked;
}else if(pagina===2){
btn.disabled=false;
}else if(pagina>=3&&pagina<=17){
let id=pagina-2;
let v=evals[id];
btn.disabled=!(v&&v.rep&&v.cal&&v.ses);
}
}

function ir_pagina_siguiente(){
if(pagina===17){
procesar();
return;
}
if(pagina<18){
pagina++;
cambiar();
}
}

function ir_pagina_anterior(){
if(pagina>0){
pagina--;
cambiar();
}
}

function procesar(){
usuario={
ts:new Date().toLocaleDateString("es-PE")+" "+new Date().toLocaleTimeString("es-PE"),
nombre:document.getElementById("nombre").value.trim(),
cmp:document.getElementById("cmp").value.trim(),
rne:document.getElementById("rne").value.trim(),
email:document.getElementById("email").value.trim(),
inst:Array.from(document.querySelectorAll("#inst-1,#inst-2,#inst-3,#inst-4,#inst-5,#inst-6,#inst-7,#inst-8")).filter(i=>i.checked).map(i=>i.value).join(", "),
exp:document.getElementById("experiencia").value.trim(),
fecha:new Date().toLocaleDateString("es-PE"),
evaluaciones:evals
};

document.getElementById("btn-siguiente").disabled=true;
document.getElementById("btn-siguiente").textContent="Enviando...";

fetch(URL_SHEETS,{
method:"POST",
body:JSON.stringify(usuario)
}).then(r=>r.json()).then(d=>{
console.log("Respuesta:",d);
mostrar();
}).catch(err=>{
console.error("Error:",err);
mostrar();
});
}

function mostrar(){
pagina=18;
cambiar();

document.getElementById("res-nombre").textContent=usuario.nombre;
document.getElementById("res-cmp").textContent=usuario.cmp;
document.getElementById("res-institucion").textContent=usuario.inst;
document.getElementById("res-fecha").textContent=usuario.fecha;

let tb=document.getElementById("cuerpo-tabla");
tb.innerHTML="";

PATOLOGIAS.forEach(p=>{
let v=usuario.evaluaciones[p.id];
if(v){
let tr=document.createElement("tr");
tr.innerHTML=`<td>${p.id}</td><td>${p.nombre}</td><td>${v.rep}</td><td>${v.cal}</td><td>${v.ses}</td>`;
tb.appendChild(tr);
}
});

document.getElementById("btn-siguiente").style.display="none";
document.getElementById("btn-atras").style.display="none";
document.getElementById("exito").style.display="block";
}

crear_imagenes();
cambiar();
</script>

</body>
</html>
