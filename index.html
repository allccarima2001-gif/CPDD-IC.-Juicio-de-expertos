<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Validaci√≥n CPDD</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:linear-gradient(135deg,#001a4d,#003d99);font-family:Arial,sans-serif;padding:20px;min-height:100vh}
.app{max-width:900px;margin:0 auto;background:#fff;border-radius:12px;padding:50px;box-shadow:0 0 30px rgba(0,0,0,0.3)}
.encabezado{text-align:center;margin-bottom:40px;padding-bottom:20px;border-bottom:3px solid #001a4d}
.encabezado h1{font-size:28px;color:#001a4d;margin-bottom:10px}
.encabezado p{color:#0052cc;font-size:13px}
.progreso{background:#e0e0e0;height:8px;border-radius:5px;margin:20px 0;overflow:hidden}
.progreso-barra{background:#001a4d;height:100%;width:5%;transition:width 0.4s}
.contador{text-align:center;font-size:12px;color:#666;margin-bottom:15px}
.contenedor-paginas{min-height:400px;position:relative}
.pagina{display:none}
.pagina.visible{display:block;animation:entrada 0.3s}
@keyframes entrada{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.titulo-pagina{font-size:16px;font-weight:bold;color:#001a4d;border-bottom:2px solid #001a4d;padding-bottom:10px;margin-bottom:20px}
.campo{margin:20px 0}
.campo label{display:block;font-weight:bold;font-size:13px;margin-bottom:8px;color:#333}
.campo input{width:100%;padding:10px;border:2px solid #ddd;border-radius:6px;font-size:14px;font-family:Arial}
.campo input:focus{outline:none;border-color:#001a4d;box-shadow:0 0 8px rgba(0,26,77,0.2)}
.grupo-checkbox{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
.item-checkbox{display:flex;gap:8px;align-items:center}
.item-checkbox input{width:16px;height:16px;cursor:pointer}
.item-checkbox label{margin:0;font-size:12px;cursor:pointer;font-weight:normal}
.aviso-consentimiento{background:#e8f4ff;border-left:4px solid #001a4d;padding:15px;border-radius:6px;font-size:12px;line-height:1.8;margin-bottom:20px}
.aviso-consentimiento p{margin:8px 0}
.aviso-consentimiento ul{margin-left:25px;margin-top:10px}
.aviso-consentimiento li{margin:5px 0}
.checkbox-unico{display:flex;gap:10px;align-items:flex-start;margin:20px 0}
.checkbox-unico input{width:18px;height:18px;cursor:pointer;margin-top:2px}
.checkbox-unico label{font-size:12px;cursor:pointer;margin:0;font-weight:normal}
.recordatorio{background:#e3f2ff;border-left:3px solid #1976d2;padding:12px;border-radius:5px;font-size:11px;color:#0d47a1;margin-bottom:20px}
.bloque-imagen{background:#f5f5f5;border-left:4px solid #0066cc;padding:18px;border-radius:6px;margin-bottom:20px}
.titulo-imagen{font-weight:bold;font-size:15px;color:#001a4d;margin-bottom:12px}
.area-imagen{width:100%;height:200px;border:2px dashed #0066cc;border-radius:6px;display:flex;align-items:center;justify-content:center;background:#e8f4ff;color:#0066cc;font-size:13px;margin-bottom:15px}
.item-criterio{margin-bottom:15px}
.etiqueta-criterio{font-size:11px;font-weight:bold;color:#333;margin-bottom:8px}
.botones-calificacion{display:flex;gap:6px}
.botones-calificacion button{flex:1;padding:8px;border:2px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;font-weight:bold;font-size:12px;transition:all 0.2s}
.botones-calificacion button:hover{border-color:#0066cc;background:#e8f4ff}
.botones-calificacion button.marcado{background:#001a4d;color:#fff;border-color:#001a4d}
.caja-resumen{background:#e8f4ff;border-left:4px solid #001a4d;padding:15px;border-radius:6px;margin-bottom:20px}
.linea-resumen{font-size:12px;margin:8px 0}
.linea-resumen strong{color:#001a4d}
.tabla-resultados{width:100%;border-collapse:collapse;margin:20px 0;background:#fff;font-size:12px;box-shadow:0 1px 5px rgba(0,0,0,0.1)}
.tabla-resultados th{background:#001a4d;color:#fff;padding:10px;text-align:left;font-weight:bold}
.tabla-resultados td{padding:10px;border-bottom:1px solid #eee}
.tabla-resultados tr:nth-child(even){background:#f9f9f9}
.seccion-resultado{text-align:center}
.titulo-resultado{font-size:24px;color:#001a4d;margin-bottom:25px;font-weight:bold}
.panel-acciones{display:flex;gap:12px;margin-top:25px;flex-wrap:wrap}
.panel-acciones button{flex:1;min-width:140px;padding:12px;border:2px solid #001a4d;background:#fff;color:#001a4d;border-radius:6px;cursor:pointer;font-weight:bold;font-size:13px;transition:all 0.2s}
.panel-acciones button:hover:not(:disabled){background:#001a4d;color:#fff}
.panel-acciones button:disabled{opacity:0.4;cursor:not-allowed}
.panel-acciones .boton-whatsapp{background:#25d366;color:#fff;border-color:#25d366}
.panel-acciones .boton-whatsapp:hover:not(:disabled){background:#1fa856;border-color:#1fa856}
.mensaje-error{background:#ffebee;color:#c62828;padding:12px;border-radius:6px;border-left:4px solid #c62828;margin-bottom:20px;display:none;font-size:12px}
.grupo-botones{display:flex;gap:12px;margin-top:40px;justify-content:space-between}
.boton{padding:12px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:14px;transition:all 0.2s}
.boton-atras{background:#ddd;color:#333}
.boton-atras:hover:not(:disabled){background:#ccc}
.boton-atras:disabled{opacity:0.5;cursor:not-allowed}
.boton-siguiente{background:#001a4d;color:#fff;flex:1;margin-left:10px}
.boton-siguiente:hover:not(:disabled){background:#003d99}
.boton-siguiente:disabled{opacity:0.4;cursor:not-allowed}
#captura-imagen{position:absolute;top:-9999px;background:#fff;padding:40px;border-radius:12px;max-width:900px;width:90%}
</style>
</head>
<body>

<div class="app">

<div class="encabezado">
<h1>VALIDACI√ìN DE EXPERTOS</h1>
<p>Cuestionario de Precisi√≥n Diagn√≥stica Dermatol√≥gica - CPDD-IC</p>
</div>

<div class="mensaje-error" id="error"></div>

<div class="contador">
<span id="contador-paginas">P√°gina 1 de 18</span>
</div>

<div class="progreso">
<div class="progreso-barra" id="barra-progreso"></div>
</div>

<div class="contenedor-paginas">

<!-- P√ÅGINA 0: DATOS -->
<div class="pagina visible" id="pagina-0">
<div class="titulo-pagina">1. DATOS DEL ESPECIALISTA</div>
<div class="campo">
<label>Nombre completo *</label>
<input type="text" id="nombre" oninput="verificar_boton()">
</div>
<div class="campo">
<label>C√©dula M√©dica (CMP) *</label>
<input type="text" id="cmp" oninput="verificar_boton()">
</div>
<div class="campo">
<label>Registro Nacional Especialista (RNE) *</label>
<input type="text" id="rne" oninput="verificar_boton()">
</div>
<div class="campo">
<label>Email *</label>
<input type="email" id="email" oninput="verificar_boton()">
</div>
<div class="campo">
<label>Instituci√≥n(es) donde trabaja * (MARCAR TODAS) *</label>
<div class="grupo-checkbox">
<div class="item-checkbox"><input type="checkbox" id="inst-1" value="MINSA" onchange="verificar_boton()"><label for="inst-1">MINSA</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-2" value="EsSalud" onchange="verificar_boton()"><label for="inst-2">EsSalud</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-3" value="Hospital Privado" onchange="verificar_boton()"><label for="inst-3">Hospital Privado</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-4" value="Cl√≠nica Privada" onchange="verificar_boton()"><label for="inst-4">Cl√≠nica Privada</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-5" value="Consultorio" onchange="verificar_boton()"><label for="inst-5">Consultorio Privado</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-6" value="Universidad" onchange="verificar_boton()"><label for="inst-6">Universidad</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-7" value="Instituto" onchange="verificar_boton()"><label for="inst-7">Instituto</label></div>
<div class="item-checkbox"><input type="checkbox" id="inst-8" value="Otro" onchange="verificar_boton()"><label for="inst-8">Otro</label></div>
</div>
</div>
<div class="campo">
<label>A√±os de experiencia en dermatolog√≠a *</label>
<input type="number" id="experiencia" min="1" max="80" oninput="verificar_boton()">
</div>
</div>

<!-- P√ÅGINA 1: CONSENTIMIENTO -->
<div class="pagina" id="pagina-1">
<div class="titulo-pagina">2. CONSENTIMIENTO INFORMADO</div>
<div class="aviso-consentimiento">
<p><strong>Estimado especialista:</strong></p>
<p>Se solicita su participaci√≥n como experto en la validaci√≥n de un instrumento de evaluaci√≥n diagn√≥stica dermatol√≥gica.</p>
<p><strong>Sus derechos:</strong></p>
<ul>
<li>Su participaci√≥n es completamente voluntaria</li>
<li>Puede retirarse en cualquier momento</li>
<li>Sus datos ser√°n tratados de forma confidencial</li>
<li>Los datos se utilizar√°n √∫nicamente con fines acad√©micos</li>
</ul>
</div>
<div class="checkbox-unico">
<input type="checkbox" id="consentimiento" onchange="verificar_boton()">
<label for="consentimiento">Acepto participar voluntariamente y autorizo el uso de mis datos</label>
</div>
</div>

<!-- P√ÅGINA 2: INSTRUCCIONES -->
<div class="pagina" id="pagina-2">
<div class="titulo-pagina">3. INSTRUCCIONES PARA LA EVALUACI√ìN</div>
<h3 style="color:#001a4d;margin-bottom:12px;font-size:14px">Escala de Calificaci√≥n (1-5):</h3>
<div style="margin-bottom:15px">
<h4 style="color:#0066cc;font-size:13px;margin-bottom:8px">Representatividad Diagn√≥stica:</h4>
<ul style="margin-left:25px;font-size:12px;line-height:1.7">
<li><strong>1-2:</strong> No representativa</li>
<li><strong>3:</strong> Moderadamente representativa</li>
<li><strong>4-5:</strong> Representativa o altamente representativa</li>
</ul>
</div>
<div style="margin-bottom:15px">
<h4 style="color:#0066cc;font-size:13px;margin-bottom:8px">Calidad T√©cnica Fotogr√°fica:</h4>
<ul style="margin-left:25px;font-size:12px;line-height:1.7">
<li><strong>1-2:</strong> Pobre/regular</li>
<li><strong>3:</strong> Aceptable</li>
<li><strong>4-5:</strong> Buena/excelente</li>
</ul>
</div>
<div style="margin-bottom:15px">
<h4 style="color:#0066cc;font-size:13px;margin-bottom:8px">Ausencia de Sesgo Visual:</h4>
<ul style="margin-left:25px;font-size:12px;line-height:1.7">
<li><strong>1-2:</strong> Presencia evidente de pistas</li>
<li><strong>3:</strong> Pocas pistas sesgadas</li>
<li><strong>4-5:</strong> Sin pistas no intencionadas</li>
</ul>
</div>
</div>

<!-- P√ÅGINAS 3-17: IM√ÅGENES -->
<div id="contenedor-imagenes"></div>

<!-- P√ÅGINA 18: RESULTADOS -->
<div class="pagina" id="pagina-18">
<div class="seccion-resultado">
<div class="titulo-resultado">‚úì Validaci√≥n Completada</div>
<div class="caja-resumen">
<div class="linea-resumen"><strong>Evaluador:</strong> <span id="res-nombre"></span></div>
<div class="linea-resumen"><strong>CMP:</strong> <span id="res-cmp"></span></div>
<div class="linea-resumen"><strong>Instituci√≥n(es):</strong> <span id="res-institucion"></span></div>
<div class="linea-resumen"><strong>Fecha:</strong> <span id="res-fecha"></span></div>
</div>
<h3 style="color:#001a4d;margin:20px 0 12px 0;font-size:14px">Resumen de Evaluaciones</h3>
<table class="tabla-resultados">
<thead><tr><th>#</th><th>Patolog√≠a</th><th>Rep</th><th>Cal</th><th>Ses</th></tr></thead>
<tbody id="cuerpo-tabla"></tbody>
</table>
<div class="panel-acciones">
<button class="boton-whatsapp" onclick="descargar_y_enviar_whatsapp()" id="btn-whatsapp" disabled>üì± Enviar por WhatsApp</button>
</div>
</div>
</div>

</div>

<!-- BOTONES NAVEGACI√ìN -->
<div class="grupo-botones">
<button class="boton boton-atras" onclick="ir_pagina_anterior()" id="btn-atras" style="display:none">‚Üê Anterior</button>
<button class="boton boton-siguiente" onclick="ir_pagina_siguiente()" id="btn-siguiente" disabled>Siguiente ‚Üí</button>
</div>

</div>

<!-- DIV PARA CAPTURA -->
<div id="captura-imagen">
<div style="text-align:center;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #001a4d">
<h2 style="color:#001a4d;font-size:22px;margin:0">VALIDACI√ìN COMPLETADA - CPDD-IC</h2>
</div>
<div style="background:#e8f4ff;border-left:4px solid #001a4d;padding:15px;border-radius:6px;margin-bottom:15px">
<div style="font-size:12px;margin:8px 0"><strong>Evaluador:</strong> <span id="cap-nombre"></span></div>
<div style="font-size:12px;margin:8px 0"><strong>CMP:</strong> <span id="cap-cmp"></span></div>
<div style="font-size:12px;margin:8px 0"><strong>Instituci√≥n:</strong> <span id="cap-institucion"></span></div>
<div style="font-size:12px;margin:8px 0"><strong>Fecha:</strong> <span id="cap-fecha"></span></div>
</div>
<h3 style="color:#001a4d;margin:15px 0 10px 0;font-size:14px;text-align:left">Resumen de Evaluaciones</h3>
<table style="width:100%;border-collapse:collapse;background:#fff;font-size:11px">
<thead><tr style="background:#001a4d;color:#fff"><th style="padding:8px;text-align:left;font-weight:bold">#</th><th style="padding:8px;text-align:left;font-weight:bold">Patolog√≠a</th><th style="padding:8px;text-align:left;font-weight:bold">Rep</th><th style="padding:8px;text-align:left;font-weight:bold">Cal</th><th style="padding:8px;text-align:left;font-weight:bold">Ses</th></tr></thead>
<tbody id="cap-tabla-cuerpo"></tbody>
</table>
</div>

<script>
const PATOLOGIAS=[
{id:1,nombre:"Acn√© vulgar"},
{id:2,nombre:"Dermatitis at√≥pica"},
{id:3,nombre:"Queratosis seborreica"},
{id:4,nombre:"Imp√©tigo no bulloso"},
{id:5,nombre:"Psoriasis"},
{id:6,nombre:"Melanoma"},
{id:7,nombre:"Verruga vulgar"},
{id:8,nombre:"Ros√°cea"},
{id:9,nombre:"Ti√±a corporis"},
{id:10,nombre:"Carcinoma basocelular"},
{id:11,nombre:"Nevo melanoc√≠tico com√∫n"},
{id:12,nombre:"Lentigo solar"},
{id:13,nombre:"Queratosis act√≠nica"},
{id:14,nombre:"Dermatitis de contacto al√©rgica"},
{id:15,nombre:"Molusco contagioso"}
];

const URL_GOOGLE_SHEETS="https://script.google.com/macros/s/AKfycbxZbkkVl_ISmtDDTUC-wtRGc3liS-h4u-cAwXAyKegb4q7iYYtiy98kLqJe3wpaMuVf/exec";
const WHATSAPP_NUMERO="51960310119";

let pagina_actual=0;
let evaluaciones_todas={};
let datos_usuario_final={};

function crear_paginas_imagenes(){
const contenedor=document.getElementById("contenedor-imagenes");
PATOLOGIAS.forEach((pat,idx)=>{
const num_pagina=idx+3;
const div=document.createElement("div");
div.className="pagina";
div.id="pagina-"+num_pagina;
div.innerHTML=`
<div class="recordatorio">Califique cada criterio de 1 (inaceptable) a 5 (excelente)</div>
<div class="bloque-imagen">
<div class="titulo-imagen">Imagen ${pat.id}: ${pat.nombre}</div>
<div class="area-imagen">[Imagen ${pat.id}]</div>
<div class="item-criterio">
<div class="etiqueta-criterio">Representatividad diagn√≥stica</div>
<div class="botones-calificacion">
<button type="button" onclick="calificar(${pat.id},'rep',1)">1</button>
<button type="button" onclick="calificar(${pat.id},'rep',2)">2</button>
<button type="button" onclick="calificar(${pat.id},'rep',3)">3</button>
<button type="button" onclick="calificar(${pat.id},'rep',4)">4</button>
<button type="button" onclick="calificar(${pat.id},'rep',5)">5</button>
</div>
</div>
<div class="item-criterio">
<div class="etiqueta-criterio">Calidad t√©cnica fotogr√°fica</div>
<div class="botones-calificacion">
<button type="button" onclick="calificar(${pat.id},'cal',1)">1</button>
<button type="button" onclick="calificar(${pat.id},'cal',2)">2</button>
<button type="button" onclick="calificar(${pat.id},'cal',3)">3</button>
<button type="button" onclick="calificar(${pat.id},'cal',4)">4</button>
<button type="button" onclick="calificar(${pat.id},'cal',5)">5</button>
</div>
</div>
<div class="item-criterio">
<div class="etiqueta-criterio">Ausencia de sesgo visual</div>
<div class="botones-calificacion">
<button type="button" onclick="calificar(${pat.id},'ses',1)">1</button>
<button type="button" onclick="calificar(${pat.id},'ses',2)">2</button>
<button type="button" onclick="calificar(${pat.id},'ses',3)">3</button>
<button type="button" onclick="calificar(${pat.id},'ses',4)">4</button>
<button type="button" onclick="calificar(${pat.id},'ses',5)">5</button>
</div>
</div>
</div>
`;
contenedor.appendChild(div);
});
}

function calificar(imagen_id,tipo,valor){
if(!evaluaciones_todas[imagen_id])evaluaciones_todas[imagen_id]={};
evaluaciones_todas[imagen_id][tipo]=valor;
event.target.parentNode.querySelectorAll("button").forEach(btn=>btn.classList.remove("marcado"));
event.target.classList.add("marcado");
verificar_boton();
}

function cambiar_pagina(){
document.querySelectorAll(".pagina").forEach(p=>p.classList.remove("visible"));
document.getElementById("pagina-"+pagina_actual).classList.add("visible");
document.getElementById("contador-paginas").textContent="P√°gina "+(pagina_actual+1)+" de 18";
document.getElementById("barra-progreso").style.width=((pagina_actual+1)/18*100)+"%";
document.getElementById("btn-atras").style.display=pagina_actual===0?"none":"block";
let btn_sig=document.getElementById("btn-siguiente");
if(pagina_actual===16){btn_sig.textContent="Enviar Validaci√≥n ‚úì"}else{btn_sig.textContent="Siguiente ‚Üí"}
verificar_boton();
}

function verificar_boton(){
let btn=document.getElementById("btn-siguiente");
if(pagina_actual===0){
let nombre=document.getElementById("nombre").value.trim();
let cmp=document.getElementById("cmp").value.trim();
let email=document.getElementById("email").value.trim();
let exp=document.getElementById("experiencia").value.trim();
let checkboxes=document.querySelectorAll("#inst-1,#inst-2,#inst-3,#inst-4,#inst-5,#inst-6,#inst-7,#inst-8");
let todas_marcadas=Array.from(checkboxes).every(cb=>cb.checked);
btn.disabled=!(nombre&&cmp&&email&&exp&&todas_marcadas);
}else if(pagina_actual===1){
btn.disabled=!document.getElementById("consentimiento").checked;
}else if(pagina_actual===2){
btn.disabled=false;
}else if(pagina_actual>=3&&pagina_actual<=16){
let img_id=pagina_actual-2;
let ev=evaluaciones_todas[img_id];
btn.disabled=!(ev&&ev.rep&&ev.cal&&ev.ses);
}
}

function ir_pagina_siguiente(){
if(pagina_actual===16){
guardar_y_enviar();
return;
}
if(pagina_actual<17){
pagina_actual++;
cambiar_pagina();
}
}

function ir_pagina_anterior(){
if(pagina_actual>0){
pagina_actual--;
cambiar_pagina();
}
}

function guardar_y_enviar(){
datos_usuario_final={
timestamp:new Date().toLocaleDateString("es-PE")+" "+new Date().toLocaleTimeString("es-PE"),
nombre:document.getElementById("nombre").value.trim(),
cmp:document.getElementById("cmp").value.trim(),
rne:document.getElementById("rne").value.trim(),
email:document.getElementById("email").value.trim(),
institucion:Array.from(document.querySelectorAll("#inst-1,#inst-2,#inst-3,#inst-4,#inst-5,#inst-6,#inst-7,#inst-8")).filter(cb=>cb.checked).map(cb=>cb.value).join(", "),
experiencia:document.getElementById("experiencia").value.trim(),
fecha:new Date().toLocaleDateString("es-PE"),
evaluaciones:evaluaciones_todas
};

document.getElementById("btn-siguiente").disabled=true;
document.getElementById("btn-siguiente").textContent="Enviando...";

fetch(URL_GOOGLE_SHEETS,{
method:"POST",
body:JSON.stringify(datos_usuario_final)
}).then(res=>res.json()).then(data=>{
console.log("Enviado a Google Sheets:",data);
mostrar_resultados();
}).catch(err=>{
console.error("Error:",err);
mostrar_resultados();
});
}

function mostrar_resultados(){
pagina_actual=18;
cambiar_pagina();

document.getElementById("res-nombre").textContent=datos_usuario_final.nombre;
document.getElementById("res-cmp").textContent=datos_usuario_final.cmp;
document.getElementById("res-institucion").textContent=datos_usuario_final.institucion;
document.getElementById("res-fecha").textContent=datos_usuario_final.fecha;

document.getElementById("cap-nombre").textContent=datos_usuario_final.nombre;
document.getElementById("cap-cmp").textContent=datos_usuario_final.cmp;
document.getElementById("cap-institucion").textContent=datos_usuario_final.institucion;
document.getElementById("cap-fecha").textContent=datos_usuario_final.fecha;

let tbody=document.getElementById("cuerpo-tabla");
let tbody_cap=document.getElementById("cap-tabla-cuerpo");
tbody.innerHTML="";
tbody_cap.innerHTML="";

PATOLOGIAS.forEach(pat=>{
let ev=datos_usuario_final.evaluaciones[pat.id];
if(ev){
let tr=document.createElement("tr");
tr.innerHTML=`<td>${pat.id}</td><td>${pat.nombre}</td><td>${ev.rep}</td><td>${ev.cal}</td><td>${ev.ses}</td>`;
tbody.appendChild(tr);

let tr_cap=document.createElement("tr");
tr_cap.innerHTML=`<td style="padding:8px;border-bottom:1px solid #eee">${pat.id}</td><td style="padding:8px;border-bottom:1px solid #eee">${pat.nombre}</td><td style="padding:8px;border-bottom:1px solid #eee">${ev.rep}</td><td style="padding:8px;border-bottom:1px solid #eee">${ev.cal}</td><td style="padding:8px;border-bottom:1px solid #eee">${ev.ses}</td>`;
tbody_cap.appendChild(tr_cap);
}
});

document.getElementById("btn-siguiente").style.display="none";
document.getElementById("btn-atras").style.display="none";
document.getElementById("btn-whatsapp").disabled=false;
}

async function descargar_y_enviar_whatsapp(){
try{
const elemento=document.getElementById("captura-imagen");
const canvas=await html2canvas(elemento,{scale:2,useCORS:true,backgroundColor:"#ffffff"});
const imagen_jpg=canvas.toDataURL("image/jpeg",0.95);

const link=document.createElement("a");
link.href=imagen_jpg;
link.download=`validacion_${datos_usuario_final.nombre.replace(/\s+/g,"_")}.jpg`;
link.click();

window.open(`https://wa.me/${WHATSAPP_NUMERO}?text=He%20completado%20la%20validaci%C3%B3n%20de%20expertos%20CPDD-IC.%20Adjunto%20resumen.`,"_blank");
}catch(err){
console.error("Error:",err);
alert("Error generando imagen.");
}
}

crear_paginas_imagenes();
cambiar_pagina();
</script>

</body>
</html>
