<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Validaci√≥n CPDD</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;width:100%}
body{background:linear-gradient(135deg,#001a4d,#003d99);font-family:Arial,sans-serif;padding:20px}
.wrapper{max-width:850px;margin:0 auto;background:#fff;border-radius:12px;padding:50px;box-shadow:0 0 30px rgba(0,0,0,0.3)}
.titulo{text-align:center;color:#001a4d;margin-bottom:40px}
.titulo h1{font-size:28px;margin-bottom:10px}
.titulo p{color:#0052cc;font-size:13px}
.barra{width:100%;height:8px;background:#e0e0e0;border-radius:5px;margin:20px 0;overflow:hidden}
.barra-fill{height:100%;background:#001a4d;width:5%;transition:width 0.4s}
.info-pag{text-align:center;font-size:12px;color:#666;margin-bottom:15px}
.secciones{position:relative;min-height:400px}
.seccion{display:none;animation:fadeIn 0.3s}
.seccion.activo{display:block}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.subtitulo{font-size:16px;font-weight:bold;color:#001a4d;border-bottom:2px solid #001a4d;padding-bottom:10px;margin-bottom:20px}
.campo{margin:20px 0}
.campo label{display:block;font-weight:bold;font-size:13px;margin-bottom:8px;color:#333}
.campo input{width:100%;padding:10px;border:2px solid #ddd;border-radius:6px;font-size:14px}
.campo input:focus{outline:none;border-color:#001a4d;box-shadow:0 0 8px rgba(0,26,77,0.2)}
.grupo-check{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
.item-check{display:flex;gap:8px;align-items:center}
.item-check input{width:16px;height:16px;cursor:pointer}
.item-check label{margin:0;font-size:12px;cursor:pointer;font-weight:normal}
.consentimiento{background:#e8f4ff;border-left:4px solid #001a4d;padding:15px;border-radius:6px;font-size:12px;line-height:1.8;margin-bottom:20px}
.consentimiento p{margin:8px 0}
.consentimiento ul{margin-left:25px;margin-top:10px}
.consentimiento li{margin:5px 0}
.check-single{display:flex;gap:10px;align-items:flex-start;margin:20px 0}
.check-single input{width:18px;height:18px;cursor:pointer;margin-top:2px}
.check-single label{font-size:12px;cursor:pointer;margin:0;font-weight:normal}
.hint{background:#e3f2ff;border-left:3px solid #1976d2;padding:12px;border-radius:5px;font-size:11px;color:#0d47a1;margin-bottom:20px}
.imagen-bloque{background:#f5f5f5;border-left:4px solid #0066cc;padding:18px;border-radius:6px;margin-bottom:20px}
.imagen-titulo{font-weight:bold;font-size:15px;color:#001a4d;margin-bottom:12px}
.imagen-area{width:100%;height:200px;border:2px dashed #0066cc;border-radius:6px;display:flex;align-items:center;justify-content:center;background:#e8f4ff;color:#0066cc;font-size:13px;margin-bottom:15px}
.criterio{margin-bottom:15px}
.criterio-label{font-size:11px;font-weight:bold;color:#333;margin-bottom:8px}
.botones-rating{display:flex;gap:6px}
.botones-rating button{flex:1;padding:8px;border:2px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;font-weight:bold;font-size:12px;transition:all 0.2s}
.botones-rating button:hover{border-color:#0066cc;background:#e8f4ff}
.botones-rating button.seleccionado{background:#001a4d;color:#fff;border-color:#001a4d}
.resumen{background:#e8f4ff;border-left:4px solid #001a4d;padding:15px;border-radius:6px;margin-bottom:20px}
.resumen-item{font-size:12px;margin:8px 0}
.resumen-item strong{color:#001a4d}
.tabla{width:100%;border-collapse:collapse;margin:20px 0;background:#fff;font-size:12px;box-shadow:0 1px 5px rgba(0,0,0,0.1)}
.tabla th{background:#001a4d;color:#fff;padding:10px;text-align:left;font-weight:bold}
.tabla td{padding:10px;border-bottom:1px solid #eee}
.tabla tr:nth-child(even){background:#f9f9f9}
.resultado{text-align:center}
.resultado-titulo{font-size:24px;color:#001a4d;margin-bottom:25px;font-weight:bold}
.acciones{display:flex;gap:12px;margin-top:25px;flex-wrap:wrap}
.acciones button{flex:1;min-width:140px;padding:12px;border:2px solid #001a4d;background:#fff;color:#001a4d;border-radius:6px;cursor:pointer;font-weight:bold;font-size:13px}
.acciones button:hover{background:#001a4d;color:#fff}
.acciones .whatsapp{background:#25d366;color:#fff;border-color:#25d366}
.acciones .whatsapp:hover{background:#1fa856;border-color:#1fa856}
.error{background:#ffebee;color:#c62828;padding:12px;border-radius:6px;border-left:4px solid #c62828;margin-bottom:20px;display:none;font-size:12px}
.botones-nav{display:flex;gap:12px;margin-top:40px;justify-content:space-between}
.btn-nav{padding:12px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:14px;transition:all 0.2s}
.btn-atras{background:#ddd;color:#333}
.btn-atras:hover{background:#ccc}
.btn-atras:disabled{opacity:0.5;cursor:not-allowed}
.btn-siguiente{background:#001a4d;color:#fff;flex:1;margin-left:10px}
.btn-siguiente:hover{background:#003d99}
.btn-siguiente:disabled{opacity:0.5;cursor:not-allowed}
</style>
</head>
<body>

<div class="wrapper">

<div class="titulo">
<h1>VALIDACI√ìN DE EXPERTOS</h1>
<p>Cuestionario de Precisi√≥n Diagn√≥stica Dermatol√≥gica - CPDD-IC</p>
</div>

<div class="error" id="error"></div>

<div class="info-pag">
<span id="pagina">P√°gina 1 de 18</span>
</div>

<div class="barra">
<div class="barra-fill" id="barra"></div>
</div>

<div class="secciones">

<!-- P√ÅGINA 0: DATOS -->
<div class="seccion activo" id="s0">
<div class="subtitulo">1. DATOS DEL ESPECIALISTA</div>
<div class="campo">
<label>Nombre completo *</label>
<input type="text" id="f_nombre">
</div>
<div class="campo">
<label>C√©dula M√©dica (CMP) *</label>
<input type="text" id="f_cmp">
</div>
<div class="campo">
<label>Registro Nacional Especialista (RNE) *</label>
<input type="text" id="f_rne">
</div>
<div class="campo">
<label>Email *</label>
<input type="email" id="f_email">
</div>
<div class="campo">
<label>Instituci√≥n(es) donde trabaja * (Marque todas)</label>
<div class="grupo-check">
<div class="item-check"><input type="checkbox" id="inst_1" value="MINSA"><label for="inst_1">MINSA</label></div>
<div class="item-check"><input type="checkbox" id="inst_2" value="EsSalud"><label for="inst_2">EsSalud</label></div>
<div class="item-check"><input type="checkbox" id="inst_3" value="Hospital Privado"><label for="inst_3">Hospital Privado</label></div>
<div class="item-check"><input type="checkbox" id="inst_4" value="Cl√≠nica Privada"><label for="inst_4">Cl√≠nica Privada</label></div>
<div class="item-check"><input type="checkbox" id="inst_5" value="Consultorio"><label for="inst_5">Consultorio Privado</label></div>
<div class="item-check"><input type="checkbox" id="inst_6" value="Universidad"><label for="inst_6">Universidad</label></div>
<div class="item-check"><input type="checkbox" id="inst_7" value="Instituto"><label for="inst_7">Instituto</label></div>
<div class="item-check"><input type="checkbox" id="inst_8" value="Otro"><label for="inst_8">Otro</label></div>
</div>
</div>
<div class="campo">
<label>A√±os de experiencia en dermatolog√≠a *</label>
<input type="number" id="f_exp" min="1" max="80">
</div>
</div>

<!-- P√ÅGINA 1: CONSENTIMIENTO -->
<div class="seccion" id="s1">
<div class="subtitulo">2. CONSENTIMIENTO INFORMADO</div>
<div class="consentimiento">
<p><strong>Estimado especialista:</strong></p>
<p>Se solicita su participaci√≥n como experto en la validaci√≥n de un instrumento de evaluaci√≥n diagn√≥stica dermatol√≥gica.</p>
<p><strong>Sus derechos:</strong></p>
<ul>
<li>Su participaci√≥n es completamente voluntaria</li>
<li>Puede retirarse en cualquier momento</li>
<li>Sus datos ser√°n tratados de forma confidencial</li>
<li>Los datos se utilizar√°n √∫nicamente con fines acad√©micos</li>
</ul>
</div>
<div class="check-single">
<input type="checkbox" id="f_consentimiento">
<label for="f_consentimiento">Acepto participar voluntariamente y autorizo el uso de mis datos</label>
</div>
</div>

<!-- P√ÅGINA 2: INSTRUCCIONES -->
<div class="seccion" id="s2">
<div class="subtitulo">3. INSTRUCCIONES PARA LA EVALUACI√ìN</div>
<h3 style="color:#001a4d;margin-bottom:12px;font-size:14px">Escala de Calificaci√≥n (1-5):</h3>
<div style="margin-bottom:15px">
<h4 style="color:#0066cc;font-size:13px;margin-bottom:8px">Representatividad Diagn√≥stica:</h4>
<ul style="margin-left:25px;font-size:12px;line-height:1.7">
<li><strong>1-2:</strong> No representativa</li>
<li><strong>3:</strong> Moderadamente representativa</li>
<li><strong>4-5:</strong> Representativa o altamente representativa</li>
</ul>
</div>
<div style="margin-bottom:15px">
<h4 style="color:#0066cc;font-size:13px;margin-bottom:8px">Calidad T√©cnica Fotogr√°fica:</h4>
<ul style="margin-left:25px;font-size:12px;line-height:1.7">
<li><strong>1-2:</strong> Pobre/regular</li>
<li><strong>3:</strong> Aceptable</li>
<li><strong>4-5:</strong> Buena/excelente</li>
</ul>
</div>
<div style="margin-bottom:15px">
<h4 style="color:#0066cc;font-size:13px;margin-bottom:8px">Ausencia de Sesgo Visual:</h4>
<ul style="margin-left:25px;font-size:12px;line-height:1.7">
<li><strong>1-2:</strong> Presencia evidente de pistas</li>
<li><strong>3:</strong> Pocas pistas sesgadas</li>
<li><strong>4-5:</strong> Sin pistas no intencionadas</li>
</ul>
</div>
</div>

<!-- P√ÅGINAS 3-17: IM√ÅGENES -->
<div id="imagenes-container"></div>

<!-- P√ÅGINA 18: RESULTADOS -->
<div class="seccion" id="s18">
<div class="resultado">
<div class="resultado-titulo">‚úì Validaci√≥n Completada</div>
<div class="resumen">
<div class="resumen-item"><strong>Evaluador:</strong> <span id="r_nombre"></span></div>
<div class="resumen-item"><strong>CMP:</strong> <span id="r_cmp"></span></div>
<div class="resumen-item"><strong>Instituci√≥n(es):</strong> <span id="r_inst"></span></div>
<div class="resumen-item"><strong>Fecha:</strong> <span id="r_fecha"></span></div>
</div>
<h3 style="color:#001a4d;margin:20px 0 12px 0;font-size:14px">Resumen de Evaluaciones</h3>
<table class="tabla">
<thead><tr><th>#</th><th>Patolog√≠a</th><th>Rep</th><th>Cal</th><th>Ses</th></tr></thead>
<tbody id="tabla-resultado"></tbody>
</table>
<div class="acciones">
<button class="whatsapp" onclick="enviar_whatsapp()">üì± Enviar por WhatsApp</button>
</div>
</div>
</div>

</div>

<!-- BOTONES -->
<div class="botones-nav">
<button class="btn-nav btn-atras" onclick="anterior()" id="btn_atras" style="display:none">‚Üê Anterior</button>
<button class="btn-nav btn-siguiente" onclick="siguiente()" id="btn_siguiente">Siguiente ‚Üí</button>
</div>

</div>

<script>
const PATOLOGIAS = [
  {id:1, nombre:"Acn√© vulgar"},
  {id:2, nombre:"Dermatitis at√≥pica"},
  {id:3, nombre:"Queratosis seborreica"},
  {id:4, nombre:"Imp√©tigo no bulloso"},
  {id:5, nombre:"Psoriasis"},
  {id:6, nombre:"Melanoma"},
  {id:7, nombre:"Verruga vulgar"},
  {id:8, nombre:"Ros√°cea"},
  {id:9, nombre:"Ti√±a corporis"},
  {id:10, nombre:"Carcinoma basocelular"},
  {id:11, nombre:"Nevo melanoc√≠tico com√∫n"},
  {id:12, nombre:"Lentigo solar"},
  {id:13, nombre:"Queratosis act√≠nica"},
  {id:14, nombre:"Dermatitis de contacto al√©rgica"},
  {id:15, nombre:"Molusco contagioso"}
];

const GOOGLE_SHEETS_URL = "https://script.google.com/macros/s/AKfycbxZbkkVl_ISmtDDTUC-wtRGc3liS-h4u-cAwXAyKegb4q7iYYtiy98kLqJe3wpaMuVf/exec";
const WHATSAPP_NUM = "51960310119";

let pagina_actual = 0;
let todas_evaluaciones = {};
let datos_usuario = {};

function crear_paginas_imagenes() {
  const container = document.getElementById("imagenes-container");
  
  PATOLOGIAS.forEach((pat, idx) => {
    const num_seccion = idx + 3;
    
    const seccion = document.createElement("div");
    seccion.className = "seccion";
    seccion.id = "s" + num_seccion;
    
    seccion.innerHTML = `
      <div class="hint">Califique cada criterio de 1 (inaceptable) a 5 (excelente)</div>
      <div class="imagen-bloque">
        <div class="imagen-titulo">Imagen ${pat.id}: ${pat.nombre}</div>
        <div class="imagen-area">[Imagen ${pat.id}]</div>
        
        <div class="criterio">
          <div class="criterio-label">Representatividad diagn√≥stica</div>
          <div class="botones-rating">
            <button type="button" onclick="calificar(${pat.id}, 'rep', 1)">1</button>
            <button type="button" onclick="calificar(${pat.id}, 'rep', 2)">2</button>
            <button type="button" onclick="calificar(${pat.id}, 'rep', 3)">3</button>
            <button type="button" onclick="calificar(${pat.id}, 'rep', 4)">4</button>
            <button type="button" onclick="calificar(${pat.id}, 'rep', 5)">5</button>
          </div>
        </div>
        
        <div class="criterio">
          <div class="criterio-label">Calidad t√©cnica fotogr√°fica</div>
          <div class="botones-rating">
            <button type="button" onclick="calificar(${pat.id}, 'cal', 1)">1</button>
            <button type="button" onclick="calificar(${pat.id}, 'cal', 2)">2</button>
            <button type="button" onclick="calificar(${pat.id}, 'cal', 3)">3</button>
            <button type="button" onclick="calificar(${pat.id}, 'cal', 4)">4</button>
            <button type="button" onclick="calificar(${pat.id}, 'cal', 5)">5</button>
          </div>
        </div>
        
        <div class="criterio">
          <div class="criterio-label">Ausencia de sesgo visual</div>
          <div class="botones-rating">
            <button type="button" onclick="calificar(${pat.id}, 'ses', 1)">1</button>
            <button type="button" onclick="calificar(${pat.id}, 'ses', 2)">2</button>
            <button type="button" onclick="calificar(${pat.id}, 'ses', 3)">3</button>
            <button type="button" onclick="calificar(${pat.id}, 'ses', 4)">4</button>
            <button type="button" onclick="calificar(${pat.id}, 'ses', 5)">5</button>
          </div>
        </div>
      </div>
    `;
    
    container.appendChild(seccion);
  });
}

function calificar(imagen_id, tipo, valor) {
  if (!todas_evaluaciones[imagen_id]) {
    todas_evaluaciones[imagen_id] = {};
  }
  todas_evaluaciones[imagen_id][tipo] = valor;
  
  event.target.parentNode.querySelectorAll("button").forEach(btn => {
    btn.classList.remove("seleccionado");
  });
  event.target.classList.add("seleccionado");
}

function mostrar_pagina() {
  document.querySelectorAll(".seccion").forEach(s => s.classList.remove("activo"));
  document.getElementById("s" + pagina_actual).classList.add("activo");
  
  document.getElementById("pagina").textContent = "P√°gina " + (pagina_actual + 1) + " de 18";
  document.getElementById("barra").style.width = ((pagina_actual + 1) / 18 * 100) + "%";
  
  document.getElementById("btn_atras").style.display = pagina_actual === 0 ? "none" : "block";
  document.getElementById("btn_siguiente").textContent = pagina_actual === 16 ? "Enviar Validaci√≥n ‚úì" : "Siguiente ‚Üí";
}

function validar_pagina_actual() {
  if (pagina_actual === 0) {
    let nombre = document.getElementById("f_nombre").value.trim();
    let cmp = document.getElementById("f_cmp").value.trim();
    let email = document.getElementById("f_email").value.trim();
    let inst_count = document.querySelectorAll('[id^="inst_"]:checked').length;
    
    if (!nombre || !cmp || !email || inst_count === 0) {
      mostrar_error("Completa todos los campos requeridos");
      return false;
    }
  }
  
  if (pagina_actual === 1) {
    if (!document.getElementById("f_consentimiento").checked) {
      mostrar_error("Debes aceptar el consentimiento");
      return false;
    }
  }
  
  if (pagina_actual >= 3 && pagina_actual <= 16) {
    let imagen_id = pagina_actual - 2;
    if (!todas_evaluaciones[imagen_id] || !todas_evaluaciones[imagen_id].rep || !todas_evaluaciones[imagen_id].cal || !todas_evaluaciones[imagen_id].ses) {
      mostrar_error("Califica los 3 criterios");
      return false;
    }
  }
  
  return true;
}

function siguiente() {
  if (!validar_pagina_actual()) {
    return;
  }
  
  if (pagina_actual === 16) {
    procesar_envio();
    return;
  }
  
  if (pagina_actual < 17) {
    pagina_actual++;
    mostrar_pagina();
  }
}

function anterior() {
  if (pagina_actual > 0) {
    pagina_actual--;
    mostrar_pagina();
  }
}

function procesar_envio() {
  datos_usuario = {
    timestamp: new Date().toLocaleDateString("es-PE") + " " + new Date().toLocaleTimeString("es-PE"),
    nombre: document.getElementById("f_nombre").value.trim(),
    cmp: document.getElementById("f_cmp").value.trim(),
    rne: document.getElementById("f_rne").value.trim(),
    email: document.getElementById("f_email").value.trim(),
    institucion: Array.from(document.querySelectorAll('[id^="inst_"]:checked')).map(ch => ch.value).join(", "),
    experiencia: document.getElementById("f_exp").value.trim(),
    fecha: new Date().toLocaleDateString("es-PE"),
    evaluaciones: todas_evaluaciones
  };
  
  document.getElementById("btn_siguiente").disabled = true;
  document.getElementById("btn_siguiente").textContent = "Enviando...";
  
  fetch(GOOGLE_SHEETS_URL, {
    method: "POST",
    body: JSON.stringify(datos_usuario)
  }).then(res => res.json()).then(data => {
    mostrar_resultados();
  }).catch(err => {
    console.error(err);
    mostrar_resultados();
  });
}

function mostrar_resultados() {
  pagina_actual = 18;
  mostrar_pagina();
  
  document.getElementById("r_nombre").textContent = datos_usuario.nombre;
  document.getElementById("r_cmp").textContent = datos_usuario.cmp;
  document.getElementById("r_inst").textContent = datos_usuario.institucion;
  document.getElementById("r_fecha").textContent = datos_usuario.fecha;
  
  let tbody = document.getElementById("tabla-resultado");
  tbody.innerHTML = "";
  
  PATOLOGIAS.forEach(pat => {
    let ev = datos_usuario.evaluaciones[pat.id];
    if (ev) {
      let tr = document.createElement("tr");
      tr.innerHTML = `<td>${pat.id}</td><td>${pat.nombre}</td><td>${ev.rep}</td><td>${ev.cal}</td><td>${ev.ses}</td>`;
      tbody.appendChild(tr);
    }
  });
  
  document.getElementById("btn_siguiente").style.display = "none";
  document.getElementById("btn_atras").style.display = "none";
}

function enviar_whatsapp() {
  let mensaje = "*VALIDACI√ìN EXPERTOS - CPDD-IC*\n\n";
  mensaje += "*Datos del Evaluador:*\n";
  mensaje += "Nombre: " + datos_usuario.nombre + "\n";
  mensaje += "CMP: " + datos_usuario.cmp + "\n";
  mensaje += "RNE: " + datos_usuario.rne + "\n";
  mensaje += "Email: " + datos_usuario.email + "\n";
  mensaje += "Instituci√≥n(es): " + datos_usuario.institucion + "\n";
  mensaje += "Experiencia: " + datos_usuario.experiencia + " a√±os\n";
  mensaje += "Fecha: " + datos_usuario.fecha + "\n\n";
  
  mensaje += "*Resumen de Evaluaciones (Rep/Cal/Ses):*\n";
  PATOLOGIAS.forEach(pat => {
    let ev = datos_usuario.evaluaciones[pat.id];
    if (ev) {
      mensaje += pat.id + ". " + pat.nombre + ": " + ev.rep + "/" + ev.cal + "/" + ev.ses + "\n";
    }
  });
  
  window.open("https://wa.me/" + WHATSAPP_NUM + "?text=" + encodeURIComponent(mensaje), "_blank");
}

function mostrar_error(msg) {
  let div = document.getElementById("error");
  div.textContent = msg;
  div.style.display = "block";
  setTimeout(() => div.style.display = "none", 4000);
}

// Iniciar
crear_paginas_imagenes();
mostrar_pagina();
</script>

</body>
</html>
